#pragma once
namespace Eloquent {
    namespace ML {
        namespace Port {
            class PCA {
            public:
                /**
                * Apply dimensionality reduction
                * @warn Will override the source vector if no dest provided!
                */
                void transform(float *x, float *dest = NULL) {
                    static float u[10] = { 0 };
                    u[0] = dot(x,   0.067660866341  , 0.157162046042  , 0.066552772995  , 0.07699408835  , 0.172876464404  , 0.080665177659  , 0.083749831294  , 0.189250797476  , 0.089058121423  , 0.090077445695  , 0.199220686237  , 0.103501963907  , 0.088074476472  , 0.207179956804  , 0.102050020516  , 0.086125092619  , 0.199018552017  , 0.105667475035  , 0.07999045187  , 0.188177515256  , 0.096631813114  , 0.065071539161  , 0.146484752723  , 0.080646996271  , 0.058987107613  , 0.13087500747  , 0.076749583682  , 0.035444664341  , 0.088129939762  , 0.052126703611  , 0.011873124113  , 0.065713140474  , 0.033267393749  , -0.004036708586  , 0.035770495747  , 0.023278627132  , -0.031308279088  , 0.007121531246  , 0.003054521236  , -0.043455538744  , -0.014221468106  , -0.005523723385  , -0.063523897733  , -0.061410013492  , -0.025151413353  , -0.064417112869  , -0.078321705452  , -0.026796853427  , -0.064841404107  , -0.139114127734  , -0.039627790932  , -0.061696451198  , -0.15110744019  , -0.04181960036  , -0.056915506382  , -0.176393936348  , -0.05106507355  , -0.048930822923  , -0.187962145311  , -0.057679675888  , -0.043423695196  , -0.197604756362  , -0.060070439988  , -0.035839948894  , -0.205525665789  , -0.064061621698  , -0.031600909393  , -0.209482242113  , -0.06419379327  , -0.022883506204  , -0.207681176697  , -0.058231104923  , -0.025541510298  , -0.206225326062  , -0.057172214588  , -0.023790982479  , -0.195277510903  , -0.050349109405  , -0.026011714674  , -0.188599754193  , -0.044322019212  , -0.026530500691  , -0.182855151886  , -0.041193455963  , -0.030437672021  , -0.17318655609  , -0.03561503025  , -0.03361629236  , -0.16650549957  , -0.036028097461 );
                    u[1] = dot(x,   -0.160919047849  , -0.017355179176  , 0.161446024164  , -0.166753606553  , -0.011527053129  , 0.183479795013  , -0.180011026394  , -0.004154674859  , 0.196579416597  , -0.180844724123  , 0.006184336158  , 0.214456683894  , -0.184270255054  , 0.017201271453  , 0.214462830279  , -0.176898330567  , 0.0286051837  , 0.210346481933  , -0.170092557106  , 0.038175515767  , 0.199787010582  , -0.149944542759  , 0.049704519088  , 0.163584137444  , -0.138599090002  , 0.052890255367  , 0.15942422264  , -0.10961695541  , 0.062987492524  , 0.114892358035  , -0.08825571341  , 0.064472640366  , 0.086390297966  , -0.073159404284  , 0.071241997995  , 0.067795587413  , -0.052083598902  , 0.074212616103  , 0.041930281953  , -0.031201616561  , 0.077843934785  , 0.028577579036  , 0.005180382496  , 0.080500679168  , 0.010291899381  , 0.014449273366  , 0.081264867882  , -0.003406885496  , 0.043550445005  , 0.073753009556  , -0.020053687381  , 0.049950718423  , 0.067469833985  , -0.030755063261  , 0.074192680264  , 0.057019244886  , -0.048246730491  , 0.086524415937  , 0.049119486449  , -0.062712387813  , 0.096480140938  , 0.042512128243  , -0.074181175678  , 0.106487699201  , 0.036731949445  , -0.087132467197  , 0.115966309382  , 0.032320563792  , -0.093331336625  , 0.126964345299  , 0.027536553634  , -0.100133371755  , 0.130624261445  , 0.020731269949  , -0.106688608185  , 0.137316034253  , 0.014765976361  , -0.108188022677  , 0.139200806858  , 0.00867722033  , -0.112170004808  , 0.141501108947  , 0.003256301731  , -0.109685394797  , 0.143087769422  , -0.000809887514  , -0.107458859812  , 0.143370968512  , -0.003857549164  , -0.106821410438 );
                    u[2] = dot(x,   0.117121554626  , -0.073416522216  , 0.120416309956  , 0.137685179275  , -0.084371014286  , 0.14260816569  , 0.157591626723  , -0.09467664333  , 0.15298104278  , 0.1729599128  , -0.098571430072  , 0.16958377127  , 0.177117847973  , -0.107167483946  , 0.173085710034  , 0.171473826037  , -0.099738537734  , 0.186516373392  , 0.16121576408  , -0.092096405021  , 0.172196370107  , 0.134816917328  , -0.065242638385  , 0.156848891623  , 0.129439927728  , -0.049596515608  , 0.151028722632  , 0.089887046494  , -0.024794156184  , 0.113430655564  , 0.067261784528  , -0.015975021982  , 0.083438323026  , 0.056254416065  , 0.001903662097  , 0.065331805604  , 0.042379455015  , 0.011519047324  , 0.031068180573  , 0.025309848302  , 0.021042645842  , 0.0152653819  , -0.012219168711  , 0.038061297076  , -0.024825827852  , -0.018828384502  , 0.050900058848  , -0.032685052887  , -0.058793606812  , 0.085843256832  , -0.061276108269  , -0.06366032912  , 0.089881777736  , -0.068767412029  , -0.092211482873  , 0.104753367386  , -0.083165513905  , -0.107886365775  , 0.105255450833  , -0.086487649881  , -0.12059414784  , 0.1106145586  , -0.09164039961  , -0.13159737991  , 0.11094701457  , -0.08771959674  , -0.139119561297  , 0.10781583575  , -0.088433221286  , -0.149384151971  , 0.100705046728  , -0.084822664929  , -0.145844493574  , 0.093146101661  , -0.090157108799  , -0.142045952697  , 0.077255936861  , -0.096986434112  , -0.137312575508  , 0.069026920097  , -0.103811587083  , -0.135402782144  , 0.056874452564  , -0.110109378461  , -0.12915903607  , 0.046242388468  , -0.116228026352  , -0.1230669613  , 0.039643216361  , -0.11546236093 );
                    u[3] = dot(x,   -0.025662039117  , -0.069335250634  , 0.024846565141  , -0.038757660341  , -0.078379806203  , 0.026789652081  , -0.066437585132  , -0.123024979949  , 0.042171706266  , -0.081067628097  , -0.12734281175  , 0.037258812092  , -0.10547899322  , -0.166702126365  , 0.04059922221  , -0.112794690777  , -0.176742976728  , 0.033924418428  , -0.121396592094  , -0.224251005752  , 0.010419043293  , -0.120981100466  , -0.227371953676  , -0.017144402963  , -0.129634408123  , -0.237250904027  , -0.023083820106  , -0.129039660162  , -0.233729085314  , -0.057219344113  , -0.122132278286  , -0.227503309145  , -0.067427324367  , -0.112140755418  , -0.225951340777  , -0.070476255962  , -0.103871873797  , -0.215854130275  , -0.08147992001  , -0.089458185033  , -0.217133718287  , -0.0738396833  , -0.077698860853  , -0.203318622617  , -0.082373900615  , -0.068919919848  , -0.183604196749  , -0.063352369808  , -0.05833819086  , -0.150812265072  , -0.061995996248  , -0.057207264457  , -0.139434409603  , -0.058294964175  , -0.053821366205  , -0.119477383221  , -0.055460778667  , -0.05158321561  , -0.110280818752  , -0.054605753703  , -0.05350704969  , -0.099276785326  , -0.056491076204  , -0.052374402629  , -0.095712499585  , -0.052308453096  , -0.052644533545  , -0.083860288346  , -0.061603803759  , -0.048296642623  , -0.085538780825  , -0.060650681248  , -0.046402718389  , -0.071200492203  , -0.067143814002  , -0.039584900793  , -0.071818965798  , -0.070015880611  , -0.035653122546  , -0.070057304252  , -0.068266186284  , -0.029070669677  , -0.06626781861  , -0.068427460915  , -0.027489687971  , -0.062534294901  , -0.070090620385  , -0.017780716854  , -0.058544968251  , -0.06544781075 );
                    u[4] = dot(x,   -0.010862612086  , 0.021128577393  , 0.015720774451  , -0.021139372495  , 0.026484950166  , 0.023778200892  , -0.06219479243  , 0.032618957258  , 0.026920581687  , -0.070456286377  , 0.036319238809  , 0.038732178232  , -0.10249098076  , 0.035264614381  , 0.038543448833  , -0.10070599907  , 0.043756223982  , 0.053270905001  , -0.127351790341  , 0.044142607066  , 0.054414192218  , -0.127520227184  , 0.035068056812  , 0.077294522126  , -0.150791892422  , 0.041752868394  , 0.072828176338  , -0.166135240127  , 0.03539692195  , 0.094473014435  , -0.172388529417  , 0.034804357254  , 0.106228665601  , -0.181412639535  , 0.030848040168  , 0.116378435842  , -0.185941143299  , 0.0284568989  , 0.137129749006  , -0.194483231358  , 0.040942347211  , 0.136542583273  , -0.196348310457  , 0.044503378379  , 0.144311271403  , -0.198041755742  , 0.038644860036  , 0.146392143934  , -0.192453175567  , 0.031910013881  , 0.145738874587  , -0.192108213882  , 0.032046172913  , 0.14666624329  , -0.180187883722  , 0.020533026702  , 0.136268357763  , -0.17565136477  , 0.021158307337  , 0.137146145102  , -0.16663578693  , 0.019815799067  , 0.128399721195  , -0.163842135788  , 0.02071334272  , 0.123354538958  , -0.148760394882  , 0.01944279628  , 0.115152634337  , -0.137520720437  , 0.022727818273  , 0.110968327732  , -0.126604407348  , 0.021482171793  , 0.112538472374  , -0.115918952873  , 0.022169442038  , 0.112407605114  , -0.107143918166  , 0.025371877274  , 0.117096305547  , -0.091088687945  , 0.027413677896  , 0.114441789823  , -0.085519051985  , 0.030530151132  , 0.114762382404  , -0.068253870371  , 0.032266713678  , 0.11190431547 );
                    u[5] = dot(x,   0.016923934727  , 0.113923629988  , 0.087372059646  , 0.017556806875  , 0.105253703996  , 0.091447758148  , 0.016160933154  , 0.052289495306  , 0.098501068698  , 0.019376190419  , 0.041016215827  , 0.102506209489  , 0.02527367588  , -4.0802529e-05  , 0.109200021383  , 0.023496001209  , -0.02487421086  , 0.117887591542  , 0.045224498191  , -0.091541596742  , 0.135835288947  , 0.054008408877  , -0.114616401666  , 0.147086860116  , 0.070687226492  , -0.145632956207  , 0.143530270515  , 0.08696785165  , -0.152261047762  , 0.140733755673  , 0.093904819821  , -0.153810513433  , 0.146221066437  , 0.116004977  , -0.155891029292  , 0.157902223326  , 0.121674155727  , -0.151830023857  , 0.16628385255  , 0.148555525037  , -0.161478588811  , 0.171334780207  , 0.152874287584  , -0.150754490134  , 0.177638268693  , 0.1550039621  , -0.131891754278  , 0.178152046324  , 0.149274464927  , -0.087584517544  , 0.172764583844  , 0.142787857472  , -0.076584893532  , 0.172433690875  , 0.133401646974  , -0.055002414402  , 0.154060544384  , 0.124352544924  , -0.037110038549  , 0.163872491512  , 0.102432454061  , -0.035044493151  , 0.142655305739  , 0.090494421854  , -0.025556548121  , 0.143963668666  , 0.057042476547  , -0.011252337498  , 0.111068137763  , 0.045211907916  , -0.007299335013  , 0.112542848931  , 0.026326283888  , 0.004711617696  , 0.094877495219  , 0.015014708581  , 0.015054726584  , 0.090031417419  , 0.008734285342  , 0.011054348339  , 0.081559854725  , -0.002633977953  , 0.0096523419  , 0.069266400601  , -0.004592397709  , 0.009821529552  , 0.057617629265  , -0.013316861973  , 0.010887611529  , 0.047434728382 );
                    u[6] = dot(x,   -0.19510260864  , -0.354495002067  , -0.18319005493  , -0.128670489004  , -0.316586991071  , -0.12148091442  , -0.091027823382  , -0.289229530524  , -0.10689259632  , -0.035768532711  , -0.228301483736  , -0.046412648237  , 0.020486036196  , -0.183273047012  , -0.018514961101  , 0.039378833019  , -0.114041414197  , 0.02524155005  , 0.096438600492  , -0.004067601541  , 0.071795975966  , 0.112725618148  , 0.005865952328  , 0.097819595298  , 0.141244057284  , 0.072632804803  , 0.153583552702  , 0.133746577576  , 0.073420240032  , 0.138869666884  , 0.09507221791  , 0.079187975333  , 0.131643159344  , 0.07947516345  , 0.082837039896  , 0.149097940494  , 0.064566181547  , 0.061328400253  , 0.118105192014  , 0.027860163641  , 0.06634723124  , 0.108029419036  , -0.014651197608  , 0.018094052099  , 0.05680488835  , -0.044256968734  , 0.032877817202  , 0.045005917688  , -0.076743612876  , -0.029566733448  , 0.012686975168  , -0.063813871601  , -0.02117525074  , 0.002677344251  , -0.073173662901  , -0.063596955646  , -0.001607028288  , -0.047174517399  , -0.082512883173  , -0.005205380201  , -0.04480812397  , -0.09380645403  , -0.014526665852  , -0.013073789837  , -0.103820737918  , -0.004456422154  , 0.01067860528  , -0.113885904903  , -0.00586984783  , 0.031309353946  , -0.136840401054  , 0.015879778044  , 0.046525503135  , -0.127198274383  , 0.026510774866  , 0.068532812629  , -0.139231649396  , 0.06206919582  , 0.066036020048  , -0.130587049617  , 0.064009417227  , 0.073760162355  , -0.114784495016  , 0.074969115694  , 0.072861879096  , -0.103674602705  , 0.072132142582  , 0.06380754044  , -0.081462814455  , 0.072520541071 );
                    u[7] = dot(x,   0.284106846816  , -0.194372556913  , 0.336057599761  , 0.242635392983  , -0.198392506367  , 0.25293781935  , 0.195405488504  , -0.140280773791  , 0.289438086726  , 0.118110894487  , -0.125957685859  , 0.157326166811  , 0.053076550572  , -0.097699129185  , 0.119767904391  , 0.050821920396  , -0.067361987918  , 0.009710909708  , -0.023383281264  , -0.027561070706  , -0.082529921071  , -0.013958810983  , -0.012862091939  , -0.190615954689  , -0.070555498422  , 0.030303448198  , -0.207565716518  , -0.034557734544  , 0.04262798012  , -0.207783287063  , -0.03047016128  , 0.074021444903  , -0.087071944707  , -0.036325333759  , 0.063506617352  , -0.124308648352  , -0.026041777661  , 0.086871035217  , -0.013147210823  , -0.058689067473  , 0.066650726452  , -0.034208392465  , -0.006171990711  , 0.059882456437  , 0.06720680383  , -0.040969345046  , 0.054250461203  , 0.045047642684  , 0.000687161343  , 0.016608019034  , 0.111613558425  , -0.011185074916  , 0.014139987474  , 0.088664494932  , 0.01610426746  , -0.022451100063  , 0.080158867489  , 0.027766506491  , -0.022966230266  , 0.092888507079  , 0.041397099825  , -0.063959545127  , 0.059782846861  , 0.048771480216  , -0.055699502088  , 0.077506584011  , 0.081934351929  , -0.072072289407  , 0.068795075794  , 0.078753608486  , -0.068627791542  , 0.048649427043  , 0.088453691788  , -0.067400634364  , 0.048175447461  , 0.07656236355  , -0.073548212513  , 0.05465275526  , 0.076734830411  , -0.052677468102  , 0.05595560134  , 0.078655918154  , -0.041894270824  , 0.072637524629  , 0.073237015555  , -0.030721388358  , 0.083589561332  , 0.064356955187  , -0.02130359133  , 0.092442609242 );
                    u[8] = dot(x,   -0.359778199011  , 0.07434749544  , 0.321255183162  , -0.341665987711  , 0.028833918441  , 0.191638553221  , -0.23913184037  , 0.029062104221  , 0.197555216228  , -0.192264679719  , -0.013835172627  , 0.060596378362  , -0.068901207636  , 0.006806010349  , 0.02429031096  , -0.055234792721  , -0.007664966935  , -0.057646957122  , 0.042322980213  , -0.017546499496  , -0.107998799139  , 0.044176958204  , -0.001153939302  , -0.133355504491  , 0.134486227083  , 0.025781168943  , -0.179795903496  , 0.122668456438  , 0.027374541464  , -0.135917705925  , 0.195800984418  , 0.038975323178  , -0.07365044901  , 0.137039186463  , 0.026295060663  , -0.110265059831  , 0.203449161309  , 0.037064891823  , -0.039627272681  , 0.137459631132  , -0.006179724406  , -0.061562118793  , 0.069084318554  , -0.008681154677  , -0.013783808331  , 0.071379832821  , -0.012220813217  , -0.031122946848  , -0.032498558324  , 0.042671594946  , 0.00628018882  , -0.030651877502  , 0.052761238191  , 0.007620614752  , -0.08563426418  , 0.043448665432  , 0.043437280267  , -0.10943661072  , 0.037634306835  , 0.069625290046  , -0.111140782639  , 0.011285921313  , 0.068032249712  , -0.112445505956  , 0.018599535894  , 0.077986669002  , -0.116866484915  , 0.00360758942  , 0.06886675071  , -0.11971587336  , -0.006222794194  , 0.049748715131  , -0.104453857638  , -0.044716308375  , 0.023041594338  , -0.087143723654  , -0.071948007025  , 0.027981987896  , -0.09596053479  , -0.092744442089  , -0.014713002968  , -0.079557347757  , -0.071209710231  , -0.006157586833  , -0.071655000807  , -0.084337976121  , -0.01157508185  , -0.069247240386  , -0.046045987579  , -0.022868564867 );
                    u[9] = dot(x,   0.175670304067  , 0.210656066928  , -0.23380545155  , 0.123901910991  , 0.107889363444  , -0.168468482994  , 0.03887025689  , 0.051366924758  , -0.098249439533  , -0.015956966184  , -0.016743819188  , -0.009487912686  , -0.074665667186  , -0.074202882903  , 0.043232364603  , -0.087646124203  , -0.070739924763  , 0.091791330527  , -0.09690605584  , -0.189736579213  , 0.087117218293  , -0.025326400101  , -0.125004630798  , 0.066913285099  , -0.058009574304  , -0.112278707253  , 0.006687698374  , -0.014126206239  , -0.024988229876  , -0.047589960891  , 0.054154890732  , 0.015640286606  , -0.112476016136  , 0.064319621397  , 0.066644283389  , -0.093812534835  , 0.121706516507  , 0.067246732476  , -0.100211664947  , 0.090792646314  , 0.084070491529  , -0.011054615924  , 0.121189529242  , 0.083489495941  , 0.026431972405  , 0.043117160137  , 0.13155764018  , 0.104319030401  , 0.011680355668  , 0.178887636191  , 0.129801596734  , -0.044213317629  , 0.223653466888  , 0.168380844396  , -0.056746116335  , 0.153056264839  , 0.162853008101  , -0.082585543595  , 0.117922344138  , 0.163136456561  , -0.085732621925  , 0.053914958877  , 0.081975521587  , -0.081566859448  , 0.022197106092  , 0.051970828866  , -0.069840804175  , -0.026735954546  , -0.059364110259  , -0.038494005146  , -0.099397309869  , -0.088195829993  , -0.025400468077  , -0.142950022865  , -0.119890079155  , 0.01709562568  , -0.194241256678  , -0.101730120983  , 0.028009473322  , -0.186685957875  , -0.145619804905  , 0.075040419181  , -0.15531465634  , -0.07542875034  , 0.084247259566  , -0.207784097842  , -0.050066972432  , 0.091831032374  , -0.143172284123  , -0.01623745374 );
                    memcpy(dest != NULL ? dest : x, u, sizeof(float) * 10);
                }

            protected:
                /**
                * Compute dot product with varargs
                */
                float dot(float *x, ...) {
                    va_list w;
                    va_start(w, 90);
                    static float mean[] = {  -0.339264705882 , -0.152058823529 , 0.075588235294 , -0.259558823529 , 0.025147058824 , -0.169558823529 , -0.135 , 0.099411764706 , -0.284264705882 , -0.05 , 0.200147058824 , -0.459411764706 , -0.061029411765 , 0.117352941176 , -0.434558823529 , -0.0575 , -0.1525 , -0.333823529412 , -0.073382352941 , -0.396911764706 , -0.256617647059 , -0.1975 , -1.005 , 0.153235294118 , -0.260882352941 , -1.133382352941 , 0.151764705882 , -0.501617647059 , -1.578970588235 , 0.604852941176 , -0.760147058824 , -1.732941176471 , 0.908235294118 , -0.927352941176 , -1.967941176471 , 1.168088235294 , -1.168382352941 , -2.161029411765 , 1.324117647059 , -1.35 , -2.352647058824 , 1.539705882353 , -1.601764705882 , -2.767352941176 , 1.697058823529 , -1.522647058824 , -2.746176470588 , 1.749558823529 , -1.680588235294 , -3.271617647059 , 1.913529411765 , -1.606029411765 , -3.318970588235 , 1.8775 , -1.615441176471 , -3.451470588235 , 1.899705882353 , -1.499852941176 , -3.435 , 1.873970588235 , -1.436029411765 , -3.438529411765 , 1.849705882353 , -1.337205882353 , -3.423382352941 , 1.805441176471 , -1.323970588235 , -3.298382352941 , 1.754264705882 , -1.255882352941 , -3.198529411765 , 1.795441176471 , -1.251470588235 , -3.126029411765 , 1.743088235294 , -1.280147058824 , -2.907794117647 , 1.826176470588 , -1.281029411765 , -2.798970588235 , 1.868970588235 , -1.271911764706 , -2.614558823529 , 1.853382352941 , -1.304411764706 , -2.438970588235 , 1.846470588235 , -1.301323529412 , -2.277794117647 , 1.765147058824  };
                    float dot = 0.0;

                    for (uint16_t i = 0; i < 90; i++) {
                        dot += (x[i] - mean[i]) * va_arg(w, double);
                    }

                    return dot;
                }
            };
        }
    }
}